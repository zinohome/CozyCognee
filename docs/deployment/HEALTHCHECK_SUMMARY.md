# å¥åº·æ£€æŸ¥é…ç½®æ€»ç»“

## ğŸ“Š æ‰€æœ‰æœåŠ¡å¥åº·æ£€æŸ¥é…ç½®å¯¹æ¯”

| æœåŠ¡ | æ£€æŸ¥æ–¹å¼ | ç«¯ç‚¹/å‘½ä»¤ | è¶…æ—¶æ—¶é—´ | æ£€æŸ¥é—´éš” | é‡è¯•æ¬¡æ•° | å¯åŠ¨ç­‰å¾… | çŠ¶æ€ | æ•ˆç‡è¯„åˆ† |
|------|---------|----------|---------|---------|---------|---------|------|---------|
| **cognee** | HTTP | `curl /docs` | 5s | 30s | 3 | 60s | âœ… å·²ä¼˜åŒ– | â­â­â­â­ |
| **cognee-mcp-api** | HTTP | `curl /health` | 3s | 30s | 3 | 45s | âœ… å·²ä¼˜åŒ– | â­â­â­â­â­ |
| **cognee-mcp-direct** | HTTP | `curl /health` | 3s | 30s | 3 | 60s | âœ… å·²ä¿®å¤ | â­â­â­â­ |
| **nginx** | è¿›ç¨‹+é…ç½® | `ps + nginx -t` | 10s | 30s | 3 | 10s | âœ… è‰¯å¥½ | â­â­â­â­ |
| **frontend** | HTTP | `wget /` | 5s | 30s | 3 | 30s | âœ… å·²ä¼˜åŒ– | â­â­â­â­ |
| **postgres** | ä¸“ç”¨å·¥å…· | `pg_isready` | 5s | 10s | 5 | - | âœ… ä¼˜ç§€ | â­â­â­â­â­ |
| **pgvector** | ä¸“ç”¨å·¥å…· | `pg_isready` | 5s | 10s | 5 | - | âœ… ä¼˜ç§€ | â­â­â­â­â­ |
| **redis** | ä¸“ç”¨å·¥å…· | `redis-cli ping` | 3s | 10s | 5 | - | âœ… ä¼˜ç§€ | â­â­â­â­â­ |
| **minio** | HTTP | `wget /minio/health/live` | 5s | 30s | 3 | 30s | âœ… å·²æ·»åŠ  | â­â­â­â­ |
| **neo4j** | æ•°æ®åº“æŸ¥è¯¢ | `cypher-shell RETURN 1` | 8s | 30s | 3 | 60s | âœ… å·²ä¼˜åŒ– | â­â­â­ |
| **redisinsight** | HTTP | `wget /` | 5s | 30s | 3 | 30s | âœ… å·²ä¼˜åŒ– | â­â­â­â­ |

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. **cognee** æœåŠ¡
- âœ… è¶…æ—¶æ—¶é—´ï¼š10s â†’ 5s
- âœ… å¯åŠ¨ç­‰å¾…ï¼š90s â†’ 60s
- âœ… ç«¯ç‚¹ï¼š`/docs`ï¼ˆæ­£ç¡®ï¼‰

### 2. **cognee-mcp-api** æœåŠ¡
- âœ… è¶…æ—¶æ—¶é—´ï¼š10s â†’ 3s
- âœ… å¯åŠ¨ç­‰å¾…ï¼š60s â†’ 45s
- âœ… ç«¯ç‚¹ï¼š`/health`ï¼ˆæ­£ç¡®ï¼‰

### 3. **cognee-mcp-direct** æœåŠ¡
- âœ… **ä¿®å¤**ï¼šç«¯ç‚¹ä» `/docs` â†’ `/health`ï¼ˆå…³é”®ä¿®å¤ï¼‰
- âœ… è¶…æ—¶æ—¶é—´ï¼š10s â†’ 3s
- âœ… å¯åŠ¨ç­‰å¾…ï¼š90s â†’ 60s

### 4. **frontend** æœåŠ¡
- âœ… è¶…æ—¶æ—¶é—´ï¼š10s â†’ 5s
- âœ… æ·»åŠ å¯åŠ¨ç­‰å¾…ï¼š30s

### 5. **minio** æœåŠ¡
- âœ… **æ–°å¢**ï¼šæ·»åŠ å¥åº·æ£€æŸ¥ï¼ˆä¹‹å‰ç¼ºå¤±ï¼‰
- âœ… ä½¿ç”¨ `/minio/health/live` ç«¯ç‚¹

### 6. **neo4j** æœåŠ¡
- âœ… è¶…æ—¶æ—¶é—´ï¼š10s â†’ 8s
- âœ… æ·»åŠ å¯åŠ¨ç­‰å¾…ï¼š60s

### 7. **redisinsight** æœåŠ¡
- âœ… è¶…æ—¶æ—¶é—´ï¼š10s â†’ 5s
- âœ… æ·»åŠ å¯åŠ¨ç­‰å¾…ï¼š30s

## ğŸ“ˆ æ•ˆç‡æå‡

### å¯åŠ¨æ—¶é—´ä¼˜åŒ–
- **cognee**: 90s â†’ 60sï¼ˆèŠ‚çœ 30 ç§’ï¼‰
- **cognee-mcp-api**: 60s â†’ 45sï¼ˆèŠ‚çœ 15 ç§’ï¼‰
- **cognee-mcp-direct**: 90s â†’ 60sï¼ˆèŠ‚çœ 30 ç§’ï¼‰

### å“åº”æ—¶é—´ä¼˜åŒ–
- **cognee**: 10s â†’ 5sï¼ˆå‡å°‘ 50%ï¼‰
- **cognee-mcp-api**: 10s â†’ 3sï¼ˆå‡å°‘ 70%ï¼‰
- **cognee-mcp-direct**: 10s â†’ 3sï¼ˆå‡å°‘ 70%ï¼‰
- **frontend**: 10s â†’ 5sï¼ˆå‡å°‘ 50%ï¼‰
- **neo4j**: 10s â†’ 8sï¼ˆå‡å°‘ 20%ï¼‰
- **redisinsight**: 10s â†’ 5sï¼ˆå‡å°‘ 50%ï¼‰

## ğŸ¯ æœ€ä½³å®è·µæ€»ç»“

### 1. ç«¯ç‚¹é€‰æ‹©åŸåˆ™
- **FastAPI æœåŠ¡**ï¼šä½¿ç”¨ `/docs` ç¡®ä¿å®Œå…¨å¯åŠ¨
- **MCP æœåŠ¡**ï¼šä½¿ç”¨ `/health` ç«¯ç‚¹
- **æ•°æ®åº“æœåŠ¡**ï¼šä½¿ç”¨ä¸“ç”¨å·¥å…·ï¼ˆ`pg_isready`, `redis-cli ping`ï¼‰
- **Web æœåŠ¡**ï¼šä½¿ç”¨ HTTP è¯·æ±‚

### 2. è¶…æ—¶æ—¶é—´å»ºè®®
- **è½»é‡çº§æœåŠ¡**ï¼ˆRedis, PostgreSQLï¼‰ï¼š3-5 ç§’
- **ä¸­ç­‰æœåŠ¡**ï¼ˆFastAPI, MCPï¼‰ï¼š3-5 ç§’
- **é‡é‡çº§æœåŠ¡**ï¼ˆNeo4jï¼‰ï¼š8-10 ç§’

### 3. æ£€æŸ¥é—´éš”å»ºè®®
- **å…³é”®æœåŠ¡**ï¼ˆæ•°æ®åº“ï¼‰ï¼š10 ç§’
- **åº”ç”¨æœåŠ¡**ï¼š30 ç§’
- **ç®¡ç†å·¥å…·**ï¼š30 ç§’

### 4. å¯åŠ¨ç­‰å¾…æ—¶é—´å»ºè®®
- **å¿«é€Ÿå¯åŠ¨**ï¼ˆNginx, Redisï¼‰ï¼š10-30 ç§’
- **ä¸­ç­‰å¯åŠ¨**ï¼ˆFastAPI, MCPï¼‰ï¼š45-60 ç§’
- **æ…¢é€Ÿå¯åŠ¨**ï¼ˆNeo4j, å¤§å‹åº”ç”¨ï¼‰ï¼š60-90 ç§’

### 5. é‡è¯•æ¬¡æ•°å»ºè®®
- **å…³é”®æœåŠ¡**ï¼ˆæ•°æ®åº“ï¼‰ï¼š5 æ¬¡
- **ä¸€èˆ¬æœåŠ¡**ï¼š3 æ¬¡

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **MinIO å¥åº·æ£€æŸ¥**ï¼šéœ€è¦ç¡®ä¿å®¹å™¨ä¸­æœ‰ `wget` å·¥å…·
2. **Nginx å¥åº·æ£€æŸ¥**ï¼šå½“å‰ä½¿ç”¨è¿›ç¨‹æ£€æŸ¥ï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ  HTTP æ£€æŸ¥
3. **Neo4j å¥åº·æ£€æŸ¥**ï¼š`cypher-shell` å¯åŠ¨è¾ƒæ…¢ï¼Œ8 ç§’è¶…æ—¶æ˜¯åˆç†çš„

## ğŸ“ é…ç½®ç¤ºä¾‹

### ä¼˜åŒ–åçš„é…ç½®æ¨¡æ¿

```yaml
# FastAPI æœåŠ¡
healthcheck:
  test: ["CMD", "curl", "-f", "--max-time", "5", "http://localhost:8000/docs"]
  interval: 30s
  timeout: 5s
  retries: 3
  start_period: 60s

# MCP æœåŠ¡
healthcheck:
  test: ["CMD", "curl", "-f", "--max-time", "3", "http://localhost:8000/health"]
  interval: 30s
  timeout: 3s
  retries: 3
  start_period: 45s

# æ•°æ®åº“æœåŠ¡ï¼ˆPostgreSQLï¼‰
healthcheck:
  test: ["CMD-SHELL", "pg_isready -U user -d db"]
  interval: 10s
  timeout: 5s
  retries: 5

# æ•°æ®åº“æœåŠ¡ï¼ˆRedisï¼‰
healthcheck:
  test: ["CMD", "redis-cli", "-a", "password", "ping"]
  interval: 10s
  timeout: 3s
  retries: 5

# Web æœåŠ¡
healthcheck:
  test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:PORT"]
  interval: 30s
  timeout: 5s
  retries: 3
  start_period: 30s
```

## ğŸ” éªŒè¯æ–¹æ³•

æ£€æŸ¥æ‰€æœ‰æœåŠ¡çš„å¥åº·æ£€æŸ¥çŠ¶æ€ï¼š
```bash
docker ps --format "table {{.Names}}\t{{.Status}}"
```

æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„å¥åº·æ£€æŸ¥æ—¥å¿—ï¼š
```bash
docker inspect <container_name> | grep -A 10 Healthcheck
```

æµ‹è¯•å¥åº·æ£€æŸ¥å‘½ä»¤ï¼š
```bash
docker exec <container_name> <healthcheck_command>
```

